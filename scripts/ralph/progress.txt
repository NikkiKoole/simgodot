## Codebase Patterns
- Tests are in scenes/tests/*.tscn (scenes) and scripts/tests/*.gd (code)
- Run tests with: "/Users/nikkikoole/Downloads/Godot 3.app/Contents/MacOS/Godot" --headless scenes/tests/test_*.tscn
- Or run all tests: ./run_tests.sh
- ItemEntity states: RAW, PREPPED, COOKED, DIRTY, BROKEN
- ItemEntity locations: IN_CONTAINER, IN_HAND, IN_SLOT, ON_GROUND
- Station.place_output_item() adds items as children of station
- Items falling back to ground use station.global_position for placement
- JobBoard autoload is at /root/JobBoard (NOT /root/Main/JobBoard)
- When creating test JobBoards, use free() not queue_free() to avoid stale node conflicts
- Level.all_items tracks all spawned items in the level
- Item reservation: item.reserve_item(agent) / item.release_item() / item.is_reserved()

## Key Files for Ground Item Feature
- scripts/level.gd: Has all_items array and get_ground_items_by_tag() (US-001 complete)
- scripts/station.gd: Has output_slots, needs get_available_output_items_by_tag()
- scripts/job_board.gd: can_start_job() and _reserve_items_for_job() need to check all sources
- scripts/npc.gd: _find_container_with_item() needs to become _find_item_source()
- scripts/item_entity.gd: Already has location enum and reservation - no changes needed

---

## 2026-01-10 - US-001
- What was implemented: Added Level.get_ground_items_by_tag(tag: String) -> Array[ItemEntity] method
- Files changed:
  - scripts/level.gd: Added get_ground_items_by_tag() method
  - scripts/tests/test_ground_items.gd: New test file with 7 test cases (22 assertions)
  - scenes/tests/test_ground_items.tscn: New test scene
  - run_tests.sh: Added test_ground_items to test suite
- **Learnings for future iterations:**
  - GDScript type inference with `:=` fails when the source method is on a dynamically-typed variable (e.g., `level: Node2D`). Use explicit type annotations like `var result: Array[ItemEntity] = level.method()` instead.
  - Level.add_item() returns ItemEntity and automatically sets location to ON_GROUND and adds to all_items array.
  - Test scenes for Level use TestLevel node (empty level with world_map="" and auto_spawn_npcs=false) as parent, with TestRunner as child.
---
